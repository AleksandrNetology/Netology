<<<<<<< HEAD
=======
Апрель 2022
>>>>>>> 59d2265eec508b50e37bf4295cd4ea17287c5fbe
# Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения.

## Что такое виртуализация?

__Виртуализация__ — это создание изолированных окружений в рамках одного физического устройства (сервера).

Каждое окружение при этом выглядит, как отдельный компьютер со своими характеристиками, такими как:
- процессор (количество выделенных ядер),
- оперативная память,
- диски,
- сеть.

Такое окружение называют набором логических ресурсов или виртуальной машиной.

## Наборы ресурсов виртуальных машин

![](resurses.jpg)

## Что такое гипервизор?

__Гипервизор__ — это монитор виртуальных машин — программа, обеспечивающая одновременное (параллельное) выполнение нескольких операционных систем (виртуальных машин) на одном и том же физическом устройстве (сервере).

Основные задачи гипервизора:
- эмуляция аппаратных ресурсов,
- безопасное выполнение машинных инструкций,
- предотвращение выполнения команд гостевых операционных систем в режиме супервизора на хост-машине (исключение перехвата и анализа команд).

Функции гипервизора:
- Гипервизор обеспечивает изоляцию операционных систем друг от друга, защиту runtime и безопасность, а также разделение ресурсов между различными запущенными ВМ.
- Гипервизор предоставляет работающим под его управлением ВМ средства связи и взаимодействия между собой таким образом, как если бы эти ОС выполнялись на разных физических компьютерах.
- Гипервизор гарантирует независимое «включение», «перезагрузку» и «выключение» каждой ВМ с той или иной операционной системой установленной на управляемую ВМ.

Как работает гипервизор? На примере: паравиртуализации.

![](paravirtualisation.jpg)

## Типы виртуализации

- Полная (аппаратная) виртуализация. Гипервизоры первого типа работают на аппаратном уровне без необходимости установки какой-либо ОС на хост. Они сами являются ОС. Примером может сужить esxi, hiper-v и xen server, citrix.

- Паравиртуализация. Гипервизорам второго типа необходима ОС для доступа монитора виртуальных машин (гипервизора) к аппаратным ресурсам хоста. Это kvm, например, hiper-v и т.д. 

- Виртуализация уровня операционной системы. Виртуализация уровня ОС позволяет запускать изолированные и безопасные ВМ на одном хосте, но не позволяет запускать ОС с ядрами, отличными от типа ядра хостовой ОС.

## Полная (аппаратная) виртуализация

Использует менеджер виртуальных машин (гипервизор), который осуществляет связь между гостевой операционной системой и аппаратными средствами физического сервера.

![](truevirtualisation.jpg)

Примеры решений использующих полную (аппаратную) виртуализацию
![](truevirt_co.jpg)

## Паравиртуализация

Паравиртуализация разделяет процесс с гостевой ОС. Гипервизор модифицирует ядро гостевой ВМ для разделения доступа к аппаратным средствам физического сервера.

![](paravirtualisation.jpg)

Примеры решений использующих паравиртуализацию

![](paravirt_co.jpg)

Пара слов по картинке выше.
- server - это именно железный сервер;
- Operatin Sysytem - это, по словам лектора, линуксовая ОС типа Debian, Ubuntu, SentOS, RedHat;
- Hypervisor - это отдельный сервис (демон) в ОС;
- Modified guest OS ставится на базе гипервизора.


## Виртуализация уровня ОС

Позволяет запускать изолированные и безопасные ВМ на одном хосте, но не позволяет запускать ОС с ядрами, отличными от типа ядра базовой операционной системы.

![](pseudo_virt.jpg)

Примеры решений использующих виртуализацию уровня ОС

![](pseudo_co.jpg)

> Обращаем внимание, что гипервизора здесь нет.

Важно понимать, что `Docker` не является гипервизором в чистом виде, это технология со своей собственной архитектурой, но подход к управлению ресурсами хостовой машины у `Docker` очень похож на LXC-контейнеры.

# Коммерческие продукты

## VMWare 

![](vmware.jpg)

VMWare предлагает множество решений для виртуализации, в частности vSphere, который используется, как основа для кластеризации и обеспечения отказоустойчивости.

__VMware vSphere использует монолитный дизайн гипервизора__, который требует, чтобы драйверы устройств были включены в слой Hypervisor. 

В слое гипервизора находятся следующие компоненты:
- планировщик ресурсов,
- распределенная файловая система,
- весь сетевой стек,
- стек хранения данных.

Преимущества:
- Нет ограничений по выбору операционной системы, необходимой для управления всеми компонентами.
- Нет необходимости в патчах безопасности, для слоя управления.
- Высокий уровень безопасности.
- Хорошая поддержка.

Недостатки:
- Не работает с оборудованием, которое не поддерживает VMWare.
- Требует высокого уровня подготовки инженеров.

## Hyper-V

![](hiper-v.jpg)

Hyper-V от Microsoft встроен непосредственно в Windows Server, хотя он также может быть установлен как Hyper-V Server, который является автономным.

__Hyper-V использует микроядерную архитектуру__, поэтому драйверы устройств работают независимо другу от друга в управляемом слое. 

В слое управления находятся следующие компоненты продукта:
- Live-миграция виртуальных машин.
- Hyper-V реплики.
- SMB и NTFS (файловые системы).
- Миграция накопителей данных.
- Сетевой стек и стек хранения данных не являются частью компонентов продукта, а являются частью гипервизора.

Преимущества:
- Упрощенное управления драйверами устройств, широкий диапазон поддерживаемых устройств.
- Простота установки новых ролей сервера.
- Нет прерывания сервиса для обслуживания или обновления безопасности.
- Сервисы могут быть масштабированы;
- Более низкий порог вхождения для инженеров.

Недостатки:
- Необходимость установки ОС для работы слоя гипервизора.
- Ограниченная поддержка версий ОС.

# Open source продукты

## KVM

<<<<<<< HEAD
__KVM является представителем паравиртуализации__, вы можете запустить практически любую операционную систему в качестве гостевой  —  BSD / Windows / Linux и с
драйвером virtio вы получите близкую к нативной производительность.

__KVM поддерживает установку из ISO образа, а также шаблоны установки__, он поставляется с хорошим уровнем реализации безопасности, может иметь проблемы с 
I/O под тяжелой нагрузкой, которая влияет на гостевые и хостовую операционную системы.

__Каждая гостевая машина работает, как процесс на хостовой машине__, что хорошо для обнаружения источника проблемы, но также при проблемах с доступными ресурсами
на хостовой машине все гостевые подвержены проблемам с производительностью.
=======
__KVM является представителем паравиртуализации__, вы можете запустить практически любую операционную систему в качестве гостевой  —  BSD / Windows / Linux и с драйвером virtio вы получите близкую к нативной производительность.

__KVM поддерживает установку из ISO образа, а также шаблоны установки__, он поставляется с хорошим уровнем реализации безопасности, может иметь проблемы с I/O под тяжелой нагрузкой, которая влияет на гостевые и хостовую операционную системы.

__Каждая гостевая машина работает, как процесс на хостовой машине__, что хорошо для обнаружения источника проблемы, но также при проблемах с доступными ресурсами на хостовой машине все гостевые подвержены проблемам с производительностью.
>>>>>>> 59d2265eec508b50e37bf4295cd4ea17287c5fbe

__KVM является нативным, родным для большинства современных ядер Linux__.\
Это дает преимущество в производительности по сравнению с другими системами виртуализации.
При этом данный продукт относительно новый и находится в активном развитии. Большинство людей выбирают KVM из-за более низкого порога входа, хотя эта система не столь стабильна, как Xen.

## Xen

Xen поставляется в двух вариациях, и может работать одновременно на том же физическом хосте в режиме Xen PV (паравиртуализация) и HVM (полная аппаратная виртуализация).

Гостевые машины в режиме Xen PV обычно основаны на шаблонах для быстрого развертывания и высокой производительности.

Вы можете запускать свое собственное ядро в Xen PV. По умолчанию вы  можете запустить только Linux в этом режиме. Запуск BSD возможен с дополнительной конфигурацией.

Режим Xen HVM работает примерно так же, как KVM. Он имеет лучшие драйверы для Linux-дистрибутивов, однако в NetBSD и Windows, Xen HVM показывает себя хуже по сравнению
с KVM, в то время как Xen PV и Windows более совместимы.

Xen очень зрелый продукт, большинство людей выбирают его для хорошей производительности и исключительной стабильности.

Стабильность Xen обеспечивается, за счет, предварительно выделяемой RAM и CPU для гипервизора, а так как он имеет свои собственные выделенные ресурсы, то на него не могут
повлиять гостевые ОС, что и дает пресловутую стабильность в работе.

## Все против всех: VMWare vs. Hyper-V vs. KVM vs. Xen

- VMware vSphere является наиболее сбалансированным и универсальным продуктом для организаций с высокими требованиями к их виртуальной инфраструктуре.

- Hyper-V является выбором defacto для окружений с преобладанием технологий Microsoft. 

- Если вы хотите сэкономить деньги и ваши окружения представляют собой исключительно Linux, то KVM может стать неплохим вариантом платформы виртуализации.

- Xen с его надежностью и стабильностью подойдет для большинства пользователей, как универсальный гипервизор.

## IaaS продукты - облачные решения

### AWS EC2 - Amazon Web Services EC2

Сервисы облачных провайдеров  —  самая современная реализация систем управления виртуализацией. Гипервизоры и прочая реализация системы скрыта от пользователя,
при этом есть гарантированные показатели доступности и отказоустойчивости. Пользователь может создавать инфраструктуру продуктивных окружений и использовать
уникальные преимущества такие, как установка в нескольких локациях, построение цепочки с другими сервисами облака, программное API для автоматизации создания
и изменения ресурсов с помощью Terraform и Packer. 

### OpenStack

Приватные облака являются программной надстройкой для организации приватного (частного) облака, и дают часть преимуществ: 
- Построение продуктивных цепочек с другими компонентами вашей частной инфраструктуры.
- Программное API для автоматизации создания и изменения ресурсов приватного облака с помощью Terraform и Packer.

Единственный, но очень весомый недостаток:

- Очень высокий порог входа в технологию, вам потребуется выделенная команда инженеров для поддержки продуктовой инсталляции приватного облака.

Приватные облака имеют более высокий уровень безопасности, необходимый для некоторых бизнес проектов и часто используются в банках и других финансовых учреждениях.

## Аппаратная виртуализация vs. виртуализации уровня ОС

![](vir.jpg)

## Плюсы и минусы виртуализации

Плюсы:
- Высокая утилизация вычислительных мощностей.
- Снижение простоев за счет быстрого развёртывания.
- Возможность использовать подход  Infrastructure as a Code.

Минусы:
- Накладные расходы на обслуживание.
- Увеличение числа абстракций.
<<<<<<< HEAD
- Единая точка отказа, если не используется кластеризация.
=======
- Единая точка отказа, если не используется кластеризация.
>>>>>>> 59d2265eec508b50e37bf4295cd4ea17287c5fbe
